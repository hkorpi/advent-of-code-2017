(ns aoc.day5
  (:require [aoc.core :as c]
            [clojure.string :as str]))

(defn parse-instructions [source]
  (vec (map c/parse-int (str/split-lines source))))

(defn execute [[instruction-pointer program]]
  (if-some [jump (get program instruction-pointer)]
    [(+ jump instruction-pointer)
     (update program instruction-pointer inc)]
    [:exit program]))


(defn execution [source]
  (iterate execute [0 (parse-instructions source)]))

(defn count-steps-to-exit [source]
  (dec (count (take-while
    (fn [[pi _]] (not= pi :exit))
    (execution source)))))

;; Result - part 1
; (count-steps-to-exit "2\n1\n2\n-1\n2\n-3\n1\n-2\n-7\n-3\n-1\n-5\n-2\n-6\n-1\n-7\n-11\n-10\n0\n-5\n-13\n0\n-5\n-13\n-19\n-19\n-6\n-16\n1\n-18\n-28\n-8\n-15\n-15\n-32\n-25\n-33\n-7\n-13\n-20\n-33\n-33\n-3\n-10\n-32\n-9\n-12\n-35\n2\n-31\n2\n1\n-6\n1\n-15\n-51\n-20\n-28\n-38\n-3\n-36\n-29\n-19\n-48\n-39\n-56\n1\n-32\n-14\n-57\n-20\n-8\n-59\n-56\n-30\n-68\n-62\n-28\n1\n-62\n-14\n-61\n-19\n-24\n-17\n-70\n-39\n-6\n-12\n-69\n-39\n-63\n-75\n-38\n-40\n-62\n-71\n-65\n-84\n-59\n-92\n-21\n-3\n-2\n-53\n-42\n-2\n-64\n-64\n-23\n-33\n-40\n-17\n-21\n-38\n-17\n-70\n-78\n-62\n-95\n-97\n-115\n-101\n-31\n-13\n-121\n0\n-21\n-69\n-94\n-70\n-9\n-122\n-30\n-38\n-28\n-14\n-91\n-28\n-110\n-114\n-96\n-104\n-78\n-30\n-125\n-41\n-26\n-94\n-142\n-74\n-86\n-12\n-103\n-126\n-16\n-118\n-133\n-72\n-147\n-149\n-119\n-91\n-44\n-145\n-42\n-97\n-66\n-38\n-33\n-6\n-79\n-5\n-151\n-145\n-23\n-118\n-103\n-20\n-66\n-18\n-140\n-99\n-176\n-143\n-60\n-3\n-51\n-65\n-37\n-178\n-27\n-1\n-181\n-115\n-122\n-162\n-12\n-140\n-34\n-146\n-133\n-115\n-144\n-152\n-85\n-173\n-44\n-29\n-98\n-159\n-88\n-173\n-117\n-172\n-210\n-41\n-125\n-181\n-149\n-54\n-71\n-57\n-188\n-160\n-85\n-85\n-215\n-108\n-130\n-150\n-36\n-225\n-1\n-207\n-233\n-171\n-2\n-176\n-16\n-83\n-148\n-200\n-59\n-108\n-62\n-118\n-94\n-31\n-211\n-89\n-243\n-7\n-106\n-36\n-239\n-116\n-135\n-98\n-136\n-159\n-242\n-233\n-212\n-29\n-128\n-234\n-208\n-153\n-200\n-122\n-38\n-159\n-211\n-264\n-41\n-74\n-219\n-274\n-114\n-116\n-24\n-243\n-74\n-198\n-250\n-35\n-95\n-146\n-110\n-179\n-213\n-279\n-160\n-34\n-90\n-282\n-174\n-17\n-287\n-146\n-196\n-140\n-139\n-238\n-148\n-22\n-43\n-50\n-300\n-104\n-67\n-243\n-129\n-264\n-192\n-8\n-171\n-263\n-38\n-147\n-315\n-65\n-141\n-49\n-164\n-104\n-43\n-203\n-217\n-320\n-167\n-21\n-42\n-180\n1\n-89\n-67\n-27\n-319\n-131\n-240\n-211\n-283\n-148\n-341\n-207\n-97\n-242\n-183\n-339\n-182\n-97\n-157\n-53\n-346\n-112\n-282\n-127\n-226\n-341\n-196\n-230\n-362\n-191\n-180\n-347\n-223\n-5\n-278\n-217\n-50\n-268\n-288\n-258\n-300\n-353\n-296\n-221\n-303\n-167\n-378\n-259\n-17\n-199\n-140\n-323\n-352\n-226\n-380\n-299\n-88\n-265\n-315\n-285\n-139\n-331\n-146\n-282\n-331\n-279\n-347\n-13\n-26\n-156\n-299\n-364\n-155\n-309\n-280\n-34\n-362\n-16\n-193\n-240\n-194\n-55\n-315\n-292\n-121\n-110\n-334\n-95\n-341\n-118\n0\n-282\n-194\n-128\n-137\n-161\n-111\n-46\n-31\n-375\n-339\n-131\n-224\n-62\n-183\n-50\n-156\n-338\n-440\n-186\n-86\n-54\n-401\n-197\n-135\n-304\n-369\n-31\n-20\n-62\n-272\n-321\n-289\n-205\n-448\n-40\n-114\n-393\n-403\n-244\n-285\n-19\n-334\n-45\n-19\n-422\n-308\n-271\n-224\n-252\n-433\n-198\n-451\n-353\n-333\n-310\n-130\n-396\n-182\n-414\n-221\n-425\n-121\n-311\n2\n-236\n-24\n-81\n-21\n-340\n-393\n-173\n-360\n-339\n-282\n-245\n-330\n-273\n-448\n-425\n-398\n-137\n-434\n-400\n-439\n-110\n-295\n-287\n-321\n-338\n-288\n-217\n-444\n-87\n-237\n-405\n-406\n-6\n-126\n-94\n-2\n-257\n-62\n-365\n-499\n-527\n-409\n-230\n-275\n-376\n-270\n-191\n-252\n-476\n-340\n-458\n-465\n-511\n-232\n-488\n-445\n-402\n-299\n-515\n-164\n-113\n-397\n-323\n-339\n-388\n-146\n-435\n-292\n-433\n-86\n-158\n-459\n-172\n-107\n-334\n-411\n-517\n-459\n-62\n-186\n-102\n-198\n-189\n-549\n-176\n-216\n-393\n-475\n-528\n-551\n-196\n-319\n-457\n-404\n-22\n-158\n-414\n-15\n-509\n-307\n-531\n-389\n-171\n-353\n-306\n-281\n-374\n-348\n-125\n-461\n-121\n-192\n-75\n-95\n-555\n-113\n-603\n-361\n-195\n-516\n-509\n-23\n-211\n-271\n-119\n-401\n-544\n-557\n-584\n-294\n-155\n-92\n-306\n-351\n-292\n-202\n-291\n-334\n-485\n-280\n-98\n-374\n-411\n-572\n-577\n-350\n-590\n-312\n-297\n-200\n-489\n-141\n-99\n-589\n-326\n-420\n-152\n-365\n-560\n-548\n-562\n-456\n-206\n-175\n-617\n-454\n-141\n-621\n-560\n-503\n-156\n-498\n-469\n-433\n-629\n-459\n-234\n-454\n-490\n-72\n-188\n-395\n-185\n-21\n-645\n-47\n-549\n-225\n-587\n-174\n-334\n-358\n-244\n-592\n-15\n-109\n-258\n-639\n-676\n-550\n-29\n-255\n-633\n-469\n-367\n-190\n-601\n-667\n-120\n-170\n-236\n-16\n-464\n-194\n-263\n-648\n-613\n-642\n-263\n-111\n-8\n-142\n-543\n-670\n-178\n-293\n-660\n-14\n-502\n-279\n-391\n-74\n-298\n-286\n-640\n-658\n-144\n-648\n2\n-328\n-418\n-294\n-461\n-646\n-612\n-563\n-250\n-420\n-318\n-464\n-478\n-172\n-47\n-284\n-293\n-121\n-642\n-41\n-406\n-538\n-100\n-44\n-505\n-663\n-437\n-680\n-181\n-57\n-619\n-17\n-434\n-27\n-509\n-182\n-635\n-710\n-514\n-693\n-678\n-351\n-129\n-63\n-556\n-312\n-359\n-627\n-44\n-391\n-138\n-79\n-607\n-226\n-637\n-340\n-508\n-632\n-124\n-637\n-575\n-263\n-392\n-521\n-760\n-526\n-213\n-209\n-501\n-381\n-76\n-555\n-321\n-172\n-685\n-14\n-135\n-360\n-799\n-70\n-85\n-534\n-100\n-414\n-519\n-596\n-714\n-493\n-136\n-442\n-379\n-778\n-555\n-429\n-245\n-360\n-399\n-117\n-410\n-383\n-406\n-316\n-633\n-163\n-328\n-224\n-421\n-196\n-801\n-549\n-156\n-541\n-245\n-424\n-324\n-242\n-834\n-444\n-513\n-300\n-86\n-4\n-564\n-617\n-631\n-454\n-22\n-201\n-819\n-241\n-621\n-332\n-563\n-855\n-436\n-144\n-403\n-101\n-527\n-157\n-778\n-256\n-378\n-6\n-860\n-805\n-307\n-581\n-595\n-380\n-83\n-641\n-566\n-71\n-809\n-866\n-856\n-234\n-402\n-511\n-382\n-716\n-331\n-701\n-279\n-142\n-90\n-828\n-415\n-768\n-25\n-409\n-158\n-423\n-161\n-670\n-349\n-188\n-590\n-504\n-599\n-57\n-849\n-521\n-275\n-257\n-883\n-476\n-602\n-683\n-393\n-374\n-695\n-573\n-52\n-263\n-446\n-690\n-708\n-881\n-218\n-334\n-149\n-674\n-419\n-793\n-764\n-413\n-230\n-541\n-705\n-777\n-440\n-651\n-387\n-532\n-290\n-824\n-659\n-772\n-511\n-817\n-384\n-703\n-309\n-880\n-518\n-579\n-38\n-114\n-902\n-693\n-496\n-682\n-744\n-543\n-929\n-774\n-699\n-364\n-542\n-198\n-170\n-822\n-681\n-811\n-769\n-219\n-824\n-904\n-161\n-334\n-736\n-246\n-846\n-615\n-597\n-565\n-61\n-813\n-460\n-194\n-882\n-272\n-416\n-270\n-79\n-719\n-256\n-405\n-939\n-200\n-776\n-375\n-798\n-829\n-894\n-96\n-41\n-405\n-684\n-851\n-588\n-132\n-127\n-839\n-123\n-8\n-916\n-370\n-486\n-178\n-761\n-481\n-532\n-1015\n-64\n-13\n-551\n-295\n-964\n-879\n-16\n-304\n-1022\n-191\n-734\n-486\n-337\n-819\n-701\n-769\n-687\n-854\n-800\n-999\n-317\n-435\n-97\n-966\n-887\n-589\n-793\n-962\n-1032\n-595\n-19\n-119\n-857\n-520")
; => 356945